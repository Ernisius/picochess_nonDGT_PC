var Chess=function(r,e){function n(){sr=new Array(128),pr={w:x,b:x},cr=U,vr={w:0,b:0},gr=x,Er=0,hr=1,dr=[],Sr={},lr={w:[{square:ur.a1,flag:tr.QSIDE_CASTLE},{square:ur.h1,flag:tr.KSIDE_CASTLE}],b:[{square:ur.a8,flag:tr.QSIDE_CASTLE},{square:ur.h8,flag:tr.KSIDE_CASTLE}]},u(f())}function t(){o(H,z)}function o(r,e){var t=r.split(/\s+/),o=t[0],a=0;if(_r=e,!i(r).valid)return!1;n(),t[2].indexOf("K")>-1&&(vr.w|=tr.KSIDE_CASTLE),t[2].indexOf("Q")>-1&&(vr.w|=tr.QSIDE_CASTLE),t[2].indexOf("k")>-1&&(vr.b|=tr.KSIDE_CASTLE),t[2].indexOf("q")>-1&&(vr.b|=tr.QSIDE_CASTLE);for(var l=0;l<o.length;l++){var p=o.charAt(l);if("/"===p)a+=8;else if(R(p))a+=parseInt(p,10);else{var c="a">p?U:O;s({type:p.toLowerCase(),color:c},P(a)),sr[a].type===M&&_r===J&&(vr[c]&tr.QSIDE_CASTLE&&pr[c]===x&&(lr[c][0]={square:a,flag:tr.QSIDE_CASTLE}),vr[c]&tr.KSIDE_CASTLE&&pr[c]!==x&&(lr[c][1]={square:a,flag:tr.KSIDE_CASTLE})),a++}}return cr=t[1],gr="-"===t[3]?x:ur[t[3]],Er=parseInt(t[4],10),hr=parseInt(t[5],10),u(f()),!0}function i(r){var e={0:"No errors.",1:"FEN string must contain six space-delimited fields.",2:"6th field (move number) must be a positive integer.",3:"5th field (half move counter) must be a non-negative integer.",4:"4th field (en-passant square) is invalid.",5:"3rd field (castling availability) is invalid.",6:"2nd field (side to move) is invalid.",7:"1st field (piece positions) does not contain 8 '/'-delimited rows.",8:"1st field (piece positions) is invalid [consecutive numbers].",9:"1st field (piece positions) is invalid [invalid piece].",10:"1st field (piece positions) is invalid [row too large].",11:"Illegal en-passant square"},n=r.split(/\s+/);if(6!==n.length)return{valid:!1,error_number:1,error:e[1]};if(isNaN(n[5])||parseInt(n[5],10)<=0)return{valid:!1,error_number:2,error:e[2]};if(isNaN(n[4])||parseInt(n[4],10)<0)return{valid:!1,error_number:3,error:e[3]};if(!/^(-|[abcdefgh][36])$/.test(n[3]))return{valid:!1,error_number:4,error:e[4]};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(n[2]))return{valid:!1,error_number:5,error:e[5]};if(!/^(w|b)$/.test(n[1]))return{valid:!1,error_number:6,error:e[6]};var t=n[0].split("/");if(8!==t.length)return{valid:!1,error_number:7,error:e[7]};for(var o=0;o<t.length;o++){for(var i=0,f=!1,a=0;a<t[o].length;a++)if(isNaN(t[o][a])){if(!/^[prnbqkPRNBQK]$/.test(t[o][a]))return{valid:!1,error_number:9,error:e[9]};i+=1,f=!1}else{if(f)return{valid:!1,error_number:8,error:e[8]};i+=parseInt(t[o][a],10),f=!0}if(8!==i)return{valid:!1,error_number:10,error:e[10]}}return"3"===n[3][1]&&n[1]===U||"6"===n[3][1]&&n[1]===O?{valid:!1,error_number:11,error:e[11]}:{valid:!0,error_number:0,error:e[0]}}function f(){for(var r=0,e="",n=ur.a8;n<=ur.h1;n++){if(sr[n]){r>0&&(e+=r,r=0);var t=sr[n].color,o=sr[n].type;e+=t===U?o.toUpperCase():o.toLowerCase()}else r++;n+1&136&&(r>0&&(e+=r),n!==ur.h1&&(e+="/"),r=0,n+=8)}var i="";vr[U]&tr.KSIDE_CASTLE&&(i+="K"),vr[U]&tr.QSIDE_CASTLE&&(i+="Q"),vr[O]&tr.KSIDE_CASTLE&&(i+="k"),vr[O]&tr.QSIDE_CASTLE&&(i+="q"),i=i||"-";var f=gr===x?"-":P(gr);return[e,cr,i,f,Er,hr].join(" ")}function a(r){for(var e=0;e<r.length;e+=2)"string"==typeof r[e]&&"string"==typeof r[e+1]&&(Sr[r[e]]=r[e+1]);return Sr}function u(r){dr.length>0||(r!==H?(Sr.SetUp="1",Sr.FEN=r):(delete Sr.SetUp,delete Sr.FEN))}function l(r){var e=sr[ur[r]];return e?{type:e.type,color:e.color}:null}function s(r,e){if(!("type"in r&&"color"in r))return!1;if(-1===W.indexOf(r.type.toLowerCase()))return!1;if(!(e in ur))return!1;var n=ur[e];return r.type===F&&pr[r.color]!==x&&pr[r.color]!==n?!1:(sr[n]={type:r.type,color:r.color},r.type===F&&(pr[r.color]=n),u(f()),!0)}function p(r){var e=l(r);return sr[ur[r]]=null,e&&e.type===F&&(pr[e.color]=x),u(f()),e}function c(r){function e(r,e,n,t,o){var i={color:cr,from:e,to:n,flags:t,piece:r[e].type};return o&&(i.flags|=tr.PROMOTION,i.promotion=o),t&(tr.KSIDE_CASTLE|tr.QSIDE_CASTLE)||(r[n]?i.captured=r[n].type:t&tr.EP_CAPTURE&&(i.captured=$)),i}function n(r,n,t,o,i){if(r[t].type!==$||q(o)!==ar&&q(o)!==or)n.push(e(r,t,o,i));else for(var f=[G,M,B,j],a=0,u=f.length;u>a;a++)n.push(e(r,t,o,i,f[a]))}var t=[],o=cr,i=w(o),f={b:fr,w:ir},a=ur.a8,u=ur.h1,l=!1,s="undefined"!=typeof r&&"legal"in r?r.legal:!0;if("undefined"!=typeof r&&"square"in r){if(!(r.square in ur))return[];a=u=ur[r.square],l=!0}for(var p,c=a;u>=c;c++)if(136&c)c+=7;else{var E=sr[c];if(E&&E.color===o)if(E.type===$)for(p=c+V[o][0],sr[p]||(n(sr,t,c,p,tr.NORMAL),p=c+V[o][1],f[o]!==q(c)||sr[p]||n(sr,t,c,p,tr.BIG_PAWN)),h=2;4>h;h++)p=c+V[o][h],136&p||(sr[p]&&sr[p].color===i?n(sr,t,c,p,tr.CAPTURE):p===gr&&n(sr,t,c,gr,tr.EP_CAPTURE));else for(var h=0,d=X[E.type].length;d>h;h++){var S=X[E.type][h];for(p=c;;){if(p+=S,136&p)break;if(sr[p]){if(sr[p].color===o)break;n(sr,t,c,p,tr.CAPTURE);break}if(n(sr,t,c,p,tr.NORMAL),E.type===j||E.type===F)break}}}if(!l||u===pr[o]){if(vr[o]&tr.KSIDE_CASTLE)if(_r===z){var _=pr[o],b=_+2;sr[_+1]||sr[_+2]||v(i,pr[o])||v(i,_+1)||v(i,b)||n(sr,t,pr[o],b,tr.KSIDE_CASTLE)}else{var _=pr[o],b=o===U?ur.g1:ur.g8,y=lr[o][1].square,T=o===U?ur.f1:ur.f8,I=!0;if(y===T);else for(var m=y-T>0?-1:1,c=y+m;c!==T;c+=m)if(sr[c]&&c!==pr[o]){I=!1;break}var L=!0,D=v(i,_);if(_===b)sr[T]&&(L=!1);else{for(var m=_-b>0?-1:1,c=_+m;c!==b;c+=m){if(sr[c]&&c!==lr[o][1].square){L=!1;break}if(v(i,c)){D=!0;break}}sr[b]&&b!==lr[o][1].square&&(L=!1)}I&&L&&!D&&n(sr,t,pr[o],y,tr.KSIDE_CASTLE)}if(vr[o]&tr.QSIDE_CASTLE)if(_r===z){var _=pr[o],b=_-2;sr[_-1]||sr[_-2]||sr[_-3]||v(i,pr[o])||v(i,_-1)||v(i,b)||n(sr,t,pr[o],b,tr.QSIDE_CASTLE)}else{var _=pr[o],b=o===U?ur.c1:ur.c8,y=lr[o][0].square,T=o===U?ur.d1:ur.d8,I=!0;if(y!==T)for(var m=y-T>0?-1:1,c=y+m;c!==T;c+=m)if(sr[c]&&c!==pr[o]){I=!1;break}var L=!0,D=v(i,_);if(_===b)sr[T]&&(L=!1);else{for(var m=_-b>0?-1:1,c=_+m;c!==b;c+=m){if(sr[c]&&c!==lr[o][0].square){L=!1;break}if(v(i,c)){D=!0;break}}sr[b]&&b!==lr[o][0].square&&(L=!1)}I&&L&&!D&&n(sr,t,pr[o],y,tr.QSIDE_CASTLE)}}if(!s)return t;for(var P=[],c=0,d=t.length;d>c;c++)A(t[c]),g(o)||P.push(t[c]),C();return P}function v(r,e){for(var n=ur.a8;n<=ur.h1;n++)if(136&n)n+=7;else if(sr[n]&&sr[n].color===r){var t=sr[n],o=n-e,i=o+119;if(Y[i]&1<<er[t.type]){if(t.type===$){if(o>0){if(t.color===U)return!0}else if(t.color===O)return!0;continue}if("n"===t.type||"k"===t.type)return!0;for(var f=rr[i],a=n+f,u=!1;a!==e;){if(sr[a]){u=!0;break}a+=f}if(!u)return!0}}return!1}function g(r){return v(w(r),pr[r])}function E(){return g(cr)}function h(){return E()&&0===c().length}function d(){return!E()&&0===c().length}function S(){for(var r={},e=[],n=0,t=0,o=ur.a8;o<=ur.h1;o++)if(t=(t+1)%2,136&o)o+=7;else{var i=sr[o];i&&(r[i.type]=i.type in r?r[i.type]+1:1,i.type===B&&e.push(t),n++)}if(2===n)return!0;if(3===n&&(1===r[B]||1===r[j]))return!0;if(n===r[B]+2){for(var f=0,a=e.length,o=0;a>o;o++)f+=e[o];if(0===f||f===a)return!0}return!1}function _(){for(var r=[],e={},n=!1;;){var t=C();if(!t)break;r.push(t)}for(;;){var o=f().split(" ").slice(0,4).join(" ");if(e[o]=o in e?e[o]+1:1,e[o]>=3&&(n=!0),!r.length)break;A(r.pop())}return n}function b(r){dr.push({move:r,kings:{b:pr.b,w:pr.w},turn:cr,castling:{b:vr.b,w:vr.w},ep_square:gr,half_moves:Er,move_number:hr})}function A(r){var e=cr,n=w(e);if(b(r),r.piece===F||(sr[r.to]=sr[r.from],sr[r.from]=null),r.flags&tr.EP_CAPTURE&&(cr===O?sr[r.to-16]=null:sr[r.to+16]=null),r.flags&tr.PROMOTION&&(sr[r.to]={type:r.promotion,color:e}),r.piece===F){var t=r.to,o=r.from;if(r.flags&(tr.KSIDE_CASTLE|tr.QSIDE_CASTLE)){var i,f;r.flags&tr.KSIDE_CASTLE?(t=e===U?ur.g1:ur.g8,i=e===U?ur.f1:ur.f8,f=lr[e][1].square):r.flags&tr.QSIDE_CASTLE&&(t=e===U?ur.c1:ur.c8,i=e===U?ur.d1:ur.d8,f=lr[e][0].square),sr[f]=null,sr[i]={type:M,color:e}}sr[o].type!==M&&(sr[o]=null),sr[t]={type:F,color:e},pr[e]=t,vr[e]=""}if(vr[e])for(var a=0,u=lr[e].length;u>a;a++)if(r.from===lr[e][a].square&&vr[e]&lr[e][a].flag){vr[e]^=lr[e][a].flag;break}if(vr[n])for(var a=0,u=lr[n].length;u>a;a++)if(r.to===lr[n][a].square&&vr[n]&lr[n][a].flag){vr[n]^=lr[n][a].flag;break}gr=r.flags&tr.BIG_PAWN?cr===O?r.to-16:r.to+16:x,r.piece===$?Er=0:r.flags&(tr.CAPTURE|tr.EP_CAPTURE)?Er=0:Er++,cr===O&&hr++,cr=w(cr)}function C(){var r=dr.pop();if(!r)return null;var e=r.move;pr=r.kings,cr=r.turn,vr=r.castling,gr=r.ep_square,Er=r.half_moves,hr=r.move_number;var n=cr,t=w(cr);if(e.flags&(tr.KSIDE_CASTLE|tr.QSIDE_CASTLE)||(sr[e.from]=sr[e.to],sr[e.from].type=e.piece,sr[e.to]=null),e.flags&tr.CAPTURE)sr[e.to]={type:e.captured,color:t};else if(e.flags&tr.EP_CAPTURE){var o;o=n===O?e.to-16:e.to+16,sr[o]={type:$,color:t}}if(e.flags&(tr.KSIDE_CASTLE|tr.QSIDE_CASTLE)){var i,f,a=e.from,u=e.to;e.flags&tr.KSIDE_CASTLE?(i=lr[n][1].square,f=n===U?ur.f1:ur.f8,u=n===U?ur.g1:ur.g8):e.flags&tr.QSIDE_CASTLE&&(i=lr[n][0].square,f=n===U?ur.d1:ur.d8,u=n===U?ur.c1:ur.c8),sr[f]=null,sr[i]={type:M,color:n},sr[u].type!==M&&(sr[u]=null),sr[a]={type:F,color:n}}return e}function y(r,e){for(var n=c({legal:!e}),t=r.from,o=r.to,i=r.piece,f=0,a=0,u=0,l=0,s=n.length;s>l;l++){var p=n[l].from,v=n[l].to,g=n[l].piece;i===g&&t!==p&&o===v&&(f++,q(t)===q(p)&&a++,D(t)===D(p)&&u++)}return f>0?a>0&&u>0?P(t):u>0?P(t).charAt(1):P(t).charAt(0):""}function T(){for(var r="\n   +------------------------+\n",e=ur.a8;e<=ur.h1;e++){if(0===D(e)&&(r+=" "+"87654321"[q(e)]+" |"),sr[e]){var n=sr[e].type,t=sr[e].color,o=t===U?n.toUpperCase():n.toLowerCase();r+=" "+o+" "}else r+=" . ";e+1&136&&(r+="|\n",e+=8)}return r+="   +------------------------+\n",r+="     a  b  c  d  e  f  g  h\n"}function I(r,e){var n="";if(r.flags&tr.KSIDE_CASTLE)n="O-O";else if(r.flags&tr.QSIDE_CASTLE)n="O-O-O";else{var t=y(r,e);r.piece!==$&&(n+=r.piece.toUpperCase()+t),r.flags&(tr.CAPTURE|tr.EP_CAPTURE)&&(r.piece===$&&(n+=P(r.from)[0]),n+="x"),n+=P(r.to),r.flags&tr.PROMOTION&&(n+="="+r.promotion.toUpperCase())}return A(r),E()&&(n+=h()?"#":"+"),C(),n}function m(r){return r.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function L(r,e){var n=m(r);if(e){var t=n.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);if(t)var o=t[1],i=t[2],f=t[3],a=t[4]}for(var u=c(),l=0,s=u.length;s>l;l++){if(n===m(I(u[l]))||e&&n===m(I(u[l],!0)))return u[l];if(t&&(!o||o.toLowerCase()===u[l].piece)&&ur[i]===u[l].from&&ur[f]===u[l].to&&(!a||a.toLowerCase()===u[l].promotion))return u[l]}return null}function q(r){return r>>4}function D(r){return 15&r}function P(r){var e=D(r),n=q(r);return"abcdefgh".substring(e,e+1)+"87654321".substring(n,n+1)}function w(r){return r===U?O:U}function R(r){return-1!=="0123456789".indexOf(r)}function k(r){var e=K(r);e.san=I(e,!1),e.to=P(e.to),e.from=P(e.from);var n="";for(var t in tr)tr[t]&e.flags&&(n+=nr[t]);return e.flags=n,e}function K(r){var e=r instanceof Array?[]:{};for(var n in r)"object"==typeof n?e[n]=K(r[n]):e[n]=r[n];return e}function N(r){return r.replace(/^\s+|\s+$/g,"")}function Q(r){for(var e=c({legal:!1}),n=0,t=0,o=e.length;o>t;t++)A(e[t]),g(cr)||(r-1>0?n+=Q(r-1):n++),C();return n}const O="b",U="w",x=-1,$="p",j="n",B="b",M="r",G="q",F="k",W="pnbrqkPNBRQK",H="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",Z=["1-0","0-1","1/2-1/2","*"],z=0,J=1,V={b:[16,32,17,15],w:[-16,-32,-17,-15]},X={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},Y=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],rr=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],er={p:0,n:1,b:2,r:3,q:4,k:5},nr={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},tr={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},or=7,ir=6,fr=1,ar=0,ur={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119};var lr={w:[{square:ur.a1,flag:tr.QSIDE_CASTLE},{square:ur.h1,flag:tr.KSIDE_CASTLE}],b:[{square:ur.a8,flag:tr.QSIDE_CASTLE},{square:ur.h8,flag:tr.KSIDE_CASTLE}]},sr=new Array(128),pr={w:x,b:x},cr=U,vr={w:0,b:0},gr=x,Er=0,hr=1,dr=[],Sr={},_r=z;return"undefined"==typeof r&&(r=H),"undefined"==typeof e&&(e=z),o(r,e),{WHITE:U,BLACK:O,PAWN:$,KNIGHT:j,BISHOP:B,ROOK:M,QUEEN:G,KING:F,SQUARES:function(){for(var r=[],e=ur.a8;e<=ur.h1;e++)136&e?e+=7:r.push(P(e));return r}(),FLAGS:nr,load:function(r,e){return"undefined"==typeof e&&(e=z),o(r,e)},reset:function(){return t()},moves:function(r){for(var e=c(r),n=[],t=0,o=e.length;o>t;t++)"undefined"!=typeof r&&"verbose"in r&&r.verbose?n.push(k(e[t])):n.push(I(e[t],!1));return n},in_check:function(){return E()},in_checkmate:function(){return h()},in_stalemate:function(){return d()},in_draw:function(){return Er>=100||d()||S()||_()},insufficient_material:function(){return S()},in_threefold_repetition:function(){return _()},game_over:function(){return Er>=100||h()||d()||S()||_()},validate_fen:function(r){return i(r)},fen:function(){return f()},pgn:function(r){var e="object"==typeof r&&"string"==typeof r.newline_char?r.newline_char:"\n",n="object"==typeof r&&"number"==typeof r.max_width?r.max_width:0,t=[],o=!1;for(var i in Sr)t.push("["+i+' "'+Sr[i]+'"]'+e),o=!0;o&&dr.length&&t.push(e);for(var f=[];dr.length>0;)f.push(C());for(var a=[],u="";f.length>0;){var l=f.pop();dr.length||l.color!==O?l.color===U&&(u.length&&a.push(u),u=hr+"."):u=hr+". ...",u=u+" "+I(l,!1),A(l)}if(u.length&&a.push(u),"undefined"!=typeof Sr.Result&&a.push(Sr.Result),0===n)return t.join("")+a.join(" ");for(var s=0,i=0;i<a.length;i++)s+a[i].length>n&&0!==i?(" "===t[t.length-1]&&t.pop(),t.push(e),s=0):0!==i&&(t.push(" "),s++),t.push(a[i]),s+=a[i].length;return t.join("")},load_pgn:function(r,e){function n(r){return r.replace(/\\/g,"\\")}function i(r){for(var e in r)return!0;return!1}function f(r,e){for(var t="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\r?\n",o={},i=r.split(new RegExp(n(t))),f="",a="",u=0;u<i.length;u++)f=i[u].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),a=i[u].replace(/^\[[A-Za-z]+\s"(.*)"\]$/,"$1"),N(f).length>0&&(o[f]=a);return o}var u="undefined"!=typeof e&&"sloppy"in e?e.sloppy:!1,l="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\r?\n",s=new RegExp("^(\\[(.|"+n(l)+")*\\])("+n(l)+")*1.("+n(l)+"|.)*$","g"),p=r.replace(s,"$1");"["!==p[0]&&(p=""),t();var c=f(p,e);for(var v in c)a([v,c[v]]),"variant"===v.toLowerCase()&&"chess960"===c[v].toLowerCase()&&(_r=J);if("1"===c.SetUp&&!("FEN"in c&&o(c.FEN,_r)))return!1;var g=r.replace(p,"").replace(new RegExp(n(l),"g")," ");g=g.replace(/(\{[^}]+\})+?/g,"");for(var E=/(\([^\(\)]+\))+?/g;E.test(g);)g=g.replace(E,"");g=g.replace(/\d+\.(\.\.)?/g,""),g=g.replace(/\.\.\./g,""),g=g.replace(/\$\d+/g,"");var h=N(g).split(new RegExp(/\s+/));h=h.join(",").replace(/,,+/g,",").split(",");for(var d="",S=0;S<h.length-1;S++){if(d=L(h[S],u),null===d)return!1;A(d)}if(d=h[h.length-1],Z.indexOf(d)>-1)i(Sr)&&"undefined"==typeof Sr.Result&&a(["Result",d]);else{if(d=L(d,u),null===d)return!1;A(d)}return!0},header:function(){return a(arguments)},ascii:function(){return T()},turn:function(){return cr},move:function(r,e){var n="undefined"!=typeof e&&"sloppy"in e?e.sloppy:!1,t=null;if("string"==typeof r)t=L(r,n);else if("object"==typeof r)if("flags"in r&&(r.flags===nr.KSIDE_CASTLE||r.flags===nr.QSIDE_CASTLE))t=L(r.san,n);else for(var o=c(),i=0,f=o.length;f>i;i++)if(!(r.from!==P(o[i].from)||r.to!==P(o[i].to)||"promotion"in o[i]&&r.promotion!==o[i].promotion)){t=o[i];break}if(!t)return null;var a=k(t);return A(t),a},undo:function(){var r=C();return r?k(r):null},clear:function(){return n()},put:function(r,e){return s(r,e)},get:function(r){return l(r)},remove:function(r){return p(r)},perft:function(r){return Q(r)},square_color:function(r){if(r in ur){var e=ur[r];return(q(e)+D(e))%2===0?"light":"dark"}return null},history:function(r){for(var e=[],n=[],t=("undefined"!=typeof r&&"verbose"in r&&r.verbose);dr.length>0;)e.push(C());for(;e.length>0;){var o=e.pop();t?n.push(k(o)):n.push(I(o)),A(o)}return n}}};"undefined"!=typeof exports&&(exports.Chess=Chess),"undefined"!=typeof define&&define(function(){return Chess});